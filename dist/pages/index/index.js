!function(t){var e={};function a(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(n,o,function(e){return t[e]}.bind(null,o));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=3)}({0:function(t,e,a){t.exports=a.p+"pages/index/index.json"},1:function(t,e,a){t.exports=a.p+"pages/index/index.wxml"},16:function(t,e){},2:function(t,e,a){"use strict";e.__esModule=!0,e.getAppData=function(){return getApp().data},e.confidenceCoppy=function(t){var e={stage1:{title:"额..",range:[0,30]},stage2:{title:"不错哟，",range:[30,50]},stage3:{title:"厉害！",range:[50,60]},stage4:{title:"犀利！",range:[60,70]},stage5:{title:"Holy awesome！！",range:[70,80]},stage6:{title:"是ta本人？",range:[80,90]},stage7:{title:"嘿嘿，就是此人！",range:[90,100]}};for(var a in e)if(t>=e[a].range[0]&&t<e[a].range[1])return e[a].title;return"嘿嘿"},e.reverseList=function(t){var e=function(t,a){return a.length?e(t.concat(a[a.length-1]),a.slice(0,-1)):t};return e([],t)}},3:function(t,e,a){"use strict";var n=this&&this.__assign||Object.assign||function(t){for(var e,a=1,n=arguments.length;a<n;a++)for(var o in e=arguments[a])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};e.__esModule=!0;var o=a(2),r=(a(16),a(1),a(0),{api_key:"g59sAr8tmZBK4LgGBLtpY_3VRYPldTqu",api_secret:"sQOhT09otoRZLVRol7QZ0nG_QMNbYUTS"}),i=function(){function t(){this.clickNum=0,this.data={descAnimation:wx.createAnimation({}),ifAnimated:"",imageSrc:"",mergeImg:{show:!1,base64:""},selfAnimation:wx.createAnimation({}),showPopup:!1,starAnimation:wx.createAnimation({}),starInfo:{conCoppy:"",confidence:0,face_rectangle:null,name:"",url:""}},this.detected=!1}return t.prototype.onShareAppMessage=function(){return{title:"查找和你最像的明星"}},t.prototype.onReady=function(){this.showSelfImg(0)},t.prototype.onChooseImg=function(t){var e=this;wx.chooseImage({count:1,sizeType:["compressed"],success:function(t){console.log(t);var a=t.tempFilePaths;e.setData({imageSrc:a[0]})}}),this.showSelfImg(),this.detected=!1},t.prototype.previewImgs=function(t){var e=[this.data.imageSrc,this.data.starInfo.url],a={selfImg:e[0],starImg:e[1]};wx.previewImage({current:a[t.currentTarget.dataset.origin],urls:e})},t.prototype.onAbout=function(){this.setData({showPopup:!0})},t.prototype.hidePopup=function(){this.setData({showPopup:!1})},t.prototype.coppyToClipBoard=function(t){console.log(t);var e=t.currentTarget.dataset.coppyText;wx.setClipboardData({data:e,success:function(){wx.showToast({title:"已复制"})}})},t.prototype.clickAvatar=function(){this.clickNum>=2?this.animateAvatar():this.clickNum=this.clickNum+1},t.prototype.compareStart=function(t){var e=this;if(!this.detected&&this.data.imageSrc){wx.showLoading({mask:!0,title:"检测中..."});var a=this.data.imageSrc;this.searchFromFacePlusPlus(a).then(function(t){var a,n;console.log("---data",t);try{a=JSON.parse(t.data).results[0],n=JSON.parse(t.data).faces[0],e.setStarInfo(a,n,function(){wx.hideLoading(),e.showStarImg(),e.detected=!0})}catch(t){console.log("error",t),e.handleDetectErr(),a={}}console.log("info",a)}).catch(function(t){e.handleDetectErr()})}else wx.showModal({content:"请先选择一张图片",title:"温馨提示"})},t.prototype.mergeStart=function(t){var e=this;if(this.detected){wx.showLoading({mask:!0,title:"正在融合中，请稍候..."});var a=this.data.imageSrc;this.mergeFaces(a).then(function(t){var a;wx.hideLoading();try{a=JSON.parse(t.data).result}catch(t){e.handleMergeErr()}e.setData({mergeImg:{base64:"data:image/jpg;base64,"+a,show:!0}})}).catch(function(){e.handleMergeErr()})}else wx.showModal({content:"请先匹配出和图片最相似的明星",title:"温馨提示"})},t.prototype.previewMergedImg=function(){this.data.mergeImg.base64&&wx.previewImage({urls:[this.data.mergeImg.base64]})},t.prototype.cancelMergeImage=function(){this.setData({mergeImg:{base64:"",show:!1}})},t.prototype.animateAvatar=function(){this.setData({ifAnimated:"avatar-animate"})},t.prototype.handleDetectErr=function(){wx.showModal({confirmText:"OKAY👌",content:"识别不了呀，可能是因为图片太抽象，换个试试？",showCancel:!1,title:"温馨提示"}),wx.hideLoading()},t.prototype.handleMergeErr=function(){wx.showModal({confirmText:"OKAY👌",content:"额... 融合失败了，换张图片试试？",showCancel:!1,title:"温馨提示"}),wx.hideLoading()},t.prototype.setStarInfo=function(t,e,a){this.setData({starInfo:n({},t,e,{conCoppy:o.confidenceCoppy(t.confidence),name:t.user_id.split("::")[0],url:t.user_id.split("::")[1]})},function(){"function"==typeof a&&a()})},t.prototype.searchFromFacePlusPlus=function(t){return new Promise(function(e,a){wx.uploadFile({filePath:t,formData:n({},r,{faceset_token:"482fbdc115f2cc238f814def5e05c7bb"}),name:"image_file",success:function(t){200===t.statusCode?e(t):a(t)},url:"https://api-cn.faceplusplus.com/facepp/v3/search"})})},t.prototype.mergeFaces=function(t){var e=this.data.starInfo,a=e.url,o=e.face_rectangle;return new Promise(function(e,i){wx.uploadFile({filePath:t,formData:n({},r,{faceset_token:"482fbdc115f2cc238f814def5e05c7bb",merge_url:a,template_rectangle:o.top+","+o.left+","+o.width+","+o.height}),name:"template_file",success:function(t){200===t.statusCode?e(t):i(t)},url:"https://api-cn.faceplusplus.com/imagepp/v1/mergeface"})})},t.prototype.showSelfImg=function(t){void 0===t&&(t=300);var e=wx.createAnimation({}),a=wx.createAnimation({}),n=wx.createAnimation({});e.width("80%").rotateY(0).step({duration:t}),a.opacity(0).scale(0).width(0).rotateY(0).step({duration:t}),n.opacity(0).rotate(0).scale(1).step({duration:t}),this.setData({descAnimation:n.export(),selfAnimation:e.export(),starAnimation:a.export()}),this.setData({showAD:!1})},t.prototype.showStarImg=function(){var t=wx.createAnimation({}),e=wx.createAnimation({}),a=wx.createAnimation({});t.width("30%").rotateY(15).step({duration:300}),e.opacity(1).scale(1).width("70%").rotateY(-15).step({duration:300}),a.opacity(.8).rotate(-15).scale(1.5).step({duration:300}),this.setData({descAnimation:a.export(),selfAnimation:t.export(),starAnimation:e.export()}),this.setData({showAD:!0})},t}();Page(new i)}});